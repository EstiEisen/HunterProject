<div class="mr-5 px-4">
  <form #form="ngForm" (ngSubmit)="submit(form)">
    <p class="h4 mb-4">יצירת משתמש חדש</p>
    <div class="row">
      <mat-form-field class="col-6 col-lg-3">
        <input matInput type="text" [(ngModel)]="user.username" placeholder="שם משתמש" name="username" required>
      </mat-form-field>
    </div>
    <div class="row">
      <mat-form-field class="col-6 col-lg-3">
        <input matInput type="text" [(ngModel)]="user.first_name" placeholder="שם פרטי" name="first_name" required>
      </mat-form-field>
      <mat-form-field class="col-6 col-lg-3">
        <input matInput type="text" [(ngModel)]="user.last_name" placeholder="שם משפחה" name="last_name" required>
      </mat-form-field>
    </div>
    <div class="row">
      <mat-form-field class="col-6 col-lg-3">
        <input matInput placeholder="כתובת מייל" [(ngModel)]="user.email" name="email" type="email"  pattern="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" required>
      </mat-form-field>
    </div>
    <div class="row mb-4">
      <div class="col-6 col-lg-3">
        <bd-select [items]="roles" placeholder="סוג משתמש" #roleSelect="ngModel" name="role" [(ngModel)]="user.role" required></bd-select>
      </div>
    </div>
    <div>
      <p class="bold h6">בחר מודולים</p>
      <div *ngFor="let module of user.modules; let i = index" class="d-flex mb-2">
        <mat-checkbox class="check-module" [(ngModel)]="module.isEnabled" [name]="'module_' + i">{{ moduleTypes[module.name] }}</mat-checkbox>
        <mat-radio-group [(ngModel)]="module.permission_type" [name]="'permission_type_' + i" [@fade]="module.isEnabled ? 'active' : 'inactive'">
          <mat-radio-button class="ml-4" value="read">צפייה בלבד</mat-radio-button>
          <mat-radio-button class="ml-4" value="write">צפייה ועריכה</mat-radio-button>
          <mat-radio-button value="all">כל ההרשאות</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>


    <div class="unit" [@fade]="user.role !== 'admin' ? 'active' : 'inactive'">
      <p class="bold h6">בחר ישויות</p>
      <div class="w-50 d-flex align-items-center mb-2" *ngFor="let permission of user.units; let last = last; let index = index">
        <i class="fa fa-times fa-2x pointer red-color" (click)="removeUnitPermissionRow(index)" *ngIf="index > 0"></i>
        <bd-select class="ml-4" [name]="'organization' + index" [items]="organizations" placeholder="ארגון" [(ngModel)]="permission.organization_id" ></bd-select>
        <bd-select class="ml-4" [name]="'employer' + index" [items]="selectedEmployer(permission, index)" placeholder="מעסיק" [(ngModel)]="permission.employer_id"></bd-select>
        <bd-select [name]="'department' + index" [items]="selectedDepartment(permission)" placeholder="מחלקות"   [(ngModel)]="permission.departments" [multiple]="true"></bd-select>
        <i class="fa fa-plus-circle fa-2x pointer blue-color" (click)="addUnitPermissionRow()" *ngIf="last"></i>
      </div>
    </div>
    <p class="alert alert-danger" [@fade]="hasServerError ? 'active' : 'inactive'">{{ message }}</p>

    <div class="mt-3">
      <button class="btn blue-btn" type="submit">שלח</button>
    </div>
  </form>
</div>
