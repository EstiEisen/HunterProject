import {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';
import {Select2OptionData} from 'ng2-select2';
import {ContactService} from '../../_services/http/contact.service';
import {UserSessionService} from '../../../shared/_services/user-session.service';
import {EmployeeFeedback} from '../../../shared/_models/employee-feedback.model';
import {Contact} from '../../../shared/_models/contact.model';
import {FeedbackService} from "../../_services/http/feedback.service";

@Component({
  selector: 'app-feedback-employee-application',
  templateUrl: './feedback-employee-application.component.html',
  styleUrls: ['./feedback-employee-application.component.css']
})
export class FeedbackEmployeeApplicationComponent implements OnInit {
  @Output() closeApplication = new EventEmitter<number>();
  @Input() headerText: string;
  @Input() feedback: EmployeeFeedback;
  searchCriteria = {};

  contacts: Contact[] = [];
  codeFile: number;


  // files:  number[] = [];

  uplodedFile: File = <File>{};
  selectedFileId: number;
  selectedContactsIds: number[];
  comments: string;

  constructor(private contactService: ContactService,
              private userSession: UserSessionService,
              private feedbackService: FeedbackService) {
  }

  setContacts(ids: number[]): void {
    console.log(this.uplodedFile);
  }

  setFile(fileId: number): void {

  }

  ngOnInit() {
    this.codeFile = this.feedback.KOD_FILE;
    this.searchCriteria['manufacturerId'] = this.feedback.product.manufacturer.id;
    this.searchCriteria['productType'] = this.feedback.product.productType;
    this.searchCriteria['distribution'] = 5;
    this.contactService.getContacts(this.userSession.getToken(), this.searchCriteria)
      .then(response => {
        this.contacts = response;
      });
  }

  onCloseClicked(): void {
    // console.log(this.uplodedFile);
    // console.log(this.selectedFileId);
    // console.log(this.selectedContactsIds);
    // console.log(this.comments);
    this.closeApplication.emit(0);
  }

  onSubmit(): void {
    this.feedbackService.sendFeedbackApplication(this.userSession.getToken(),
      this.uplodedFile,
      this.selectedFileId,
      this.selectedContactsIds,
      this.comments)
      .then(res => console.log(res));
  }


}
