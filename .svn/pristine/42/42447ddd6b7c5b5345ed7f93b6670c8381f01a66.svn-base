import {Component, Inject, OnInit} from '@angular/core';
import { trigger, state, style, animate, transition } from '@angular/animations';

import { Employee } from '../../../shared/_models/employee.model';
import { EmployeePayment } from '../../../shared/_models/employee-payment.model';
import {MAT_DIALOG_DATA} from '@angular/material';
import {Employer} from '../../../shared/_models/employer.model';
import {EmployeeService} from '../../_services/http/employee.service';
import {UserSessionService} from '../../../shared/_services/user-session.service';
import {Select2OptionData} from 'ng2-select2';

@Component({
  selector: 'app-employee-payment-form',
  templateUrl: './employee-payment-form.component.html',
  styleUrls: ['./employee-payment-form.component.css'],
  animations: [
    trigger('slideToggle', [
      state('inactive', style({
        height: 0,
        opacity: '0',
        display: 'none'
      })),
      state('active', style({
        height: '*',
        opacity: '1',
        display: '*'
      })),
      transition('inactive => active', animate('400ms ease-in')),
      transition('active => inactive', animate('400ms ease-out'))
    ])
  ]
})
export class EmployeePaymentFormComponent implements OnInit {

  select2Options: Select2Options;

  employeesSelect2: Select2OptionData[] = [];


  employer: Employer;
  employees: Employee[] = [];
  payment: EmployeePayment = <EmployeePayment>{};
  newEmployee: Employee = <Employee>{};

  searchCriteria = {};

  constructor(@Inject(MAT_DIALOG_DATA) public data: any,
              private employeeService: EmployeeService,
              private userSessionService: UserSessionService) {
    this.employer = data.employer;
  }

  ngOnInit() {
    this.searchCriteria['employerId'] = this.employer.id;
    this.employeeService.getEmployees(this.userSessionService.getToken(), this.searchCriteria)
      .then(response => this.setData(response));
  }

  setData(response: Employee[]): void
  {
    this.employees = response;
    this.employeesSelect2 = this.setEmployeeSelect2Data(response);
  }

  private setEmployeeSelect2Data(values: Object[]): Select2OptionData[] {
    const data = [
      { id: '0', text: 'בחר עובד' }
    ];
    for (let i = 0; i < values.length; i++) {
      data[i + 1] = { id: values[i]['id'], text: values[i]['firstName'] + ' ' + values[i]['lastName'] };
    }
    return data;
  }
}
