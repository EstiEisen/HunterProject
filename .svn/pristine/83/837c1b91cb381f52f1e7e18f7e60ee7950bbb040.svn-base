<div class="mt-5 data-table">
  <p class="title text-right">תהליכים</p>
  <div class="data-table-actions">
    <mat-form-field>
      <mat-select [(ngModel)]="searchCriteria.employerID" (selectionChange)="fetchItems()" placeholder="שם מעסיק">
        <mat-option *ngFor="let employer of employers" [value]="employer.id">{{ employer.name }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="mr-3">
      <mat-select [(ngModel)]="searchCriteria.year" (selectionChange)="fetchItems()" placeholder="שנה">
        <mat-option [value]="currentYear">{{ currentYear }}</mat-option>
        <mat-option [value]="currentYear - 1">{{ currentYear - 1 }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="mr-3">
      <mat-select [(ngModel)]="searchCriteria.months" (selectionChange)="fetchItems()" placeholder="חודש" multiple>
        <div class="clear-selection">
          <span (click)="selectAllMonths()">כל החודשים</span>
          <span class="link" *ngIf="searchCriteria.months && searchCriteria.months.length === months.length" (click)="searchCriteria.months = []">נקה הכל</span>
        </div>
        <mat-option *ngFor="let month of months; let i = index" [value]="i + 1">{{ month }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <table class="table table-bordered table-striped">
    <thead>
    <tr class="headers">
      <th *ngFor="let header of headers" (click)="sort(header.column)">
        <span>{{ header.label }}</span>
        <i class="ml-3 fa float-left" *ngIf="orderCriteria['column'] === header.column"
           [ngClass]="{ 'fa-chevron-down': orderCriteria['dir'] === 'DESC',  'fa-chevron-up': orderCriteria['dir'] === 'ASC' }"></i>
      </th>
      <th>הורדת קובץ</th>
    </tr>
    </thead>
    <tbody>
    <ng-container *ngIf="!isSearching">
      <tr *ngFor="let item of paginatedItems">
        <td>
          <a (click)="handleProcessClick(item.stepStatus, item.id, item.month, item.year)">{{ item.addToProcessName }}</a>
        </td>
        <td>
          <a (click)="handleProcessClick(item.stepStatus, item.id, item.month, item.year)">{{ item.id }}</a>
        </td>
        <td>{{ months[item.month - 1] }}</td>
        <td>{{ item.year }}</td>
        <td>{{ item.codeFile }}</td>
        <td class="ltr">&#8362; {{ item.totalPaymentFile }} </td>
        <!-- <td>{{ process.labels.validityStatus[validityStatus[item.validityStatus]] }}</td> -->
        <td>{{ process.labels.stepStatus[stepStatus[item.stepStatus]] }}</td>
        <td>
          <i class="fa fa-download pointer" (click)="downloadFile(item.id)"></i>
        </td>
      </tr>
      <tr *ngIf="items.length === 0">
        <td colspan="10" class="bold">לא נמצאו תהליכים.</td>
      </tr>
    </ng-container>
    <tr *ngIf="isSearching">
      <td colspan="10">
        <mat-spinner class="mr-auto ml-auto"></mat-spinner>
      </td>
    </tr>
    </tbody>
  </table>
  <app-pagination [data]="paginationData" (isLinkClicked)="paginateItems()" *ngIf="items.length > 0"></app-pagination>
</div>
