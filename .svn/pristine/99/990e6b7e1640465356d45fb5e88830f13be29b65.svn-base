<div id="processUploadForm" class="pb-3">
  <div class="border-line"></div>
  <div class="col-lg-10 offset-lg-1">
    <form #f="ngForm" (ngSubmit)="uploadFile(f.valid)" *ngIf="!isFileUploaded" [ngClass]="{ 'locked': uploadProgressPercent }">
      <p class="h3 text-center mb-3 bold grey-color">נתוני תהליך</p>
      <div class="row justify-content-center mb-3">
        <mat-form-field class="col-12 col-sm-4">
          <input matInput name="addToProcessName" type="text" placeholder="שם תהליך" [(ngModel)]="process.addToProcessName">
        </mat-form-field>
        <mat-form-field class="col-12 col-sm-4 offset-sm-1">
          <mat-select name="employer" placeholder="שם מעסיק" [(ngModel)]="process.employer" #employerInput="ngModel" required>
            <mat-option *ngFor="let employer of employers" [value]="employer">{{ employer.name }}</mat-option>
          </mat-select>
          <mat-error *ngIf="employerInput.errors && f.submitted">יש לבחור מעסיק.</mat-error>
        </mat-form-field>
      </div>
      <div class="row justify-content-center">
        <mat-form-field class="col-12 col-sm-4">
          <mat-select name="month" placeholder="בחר חודש" [(ngModel)]="process.month" #monthSelect="ngModel" required>
            <mat-option *ngFor="let month of months; let i = index" [value]="i + 1">{{ month }}</mat-option>
          </mat-select>
          <mat-error *ngIf="monthSelect.errors && f.submitted">יש לבחור חודש.</mat-error>
        </mat-form-field>
        <mat-form-field class="col-12 col-sm-4 offset-sm-1">
          <mat-select name="year" placeholder="בחר שנה" [(ngModel)]="process.year" #yearSelect="ngModel" required>
            <mat-option [value]="currentYear">{{ currentYear }}</mat-option>
            <mat-option [value]="currentYear - 1">{{ currentYear - 1 }}</mat-option>
          </mat-select>
          <mat-error *ngIf="yearSelect.errors && f.submitted">יש לבחור שנה.</mat-error>
        </mat-form-field>
      </div>
      <div class="row justify-content-center mb-2 mt-2 mt-sm-5 mb-sm-5">
        <div class="col-10 col-sm-4 col-lg-2 offset-1 offset-sm-0 mb-2 mb-sm-0 ml-sm-3 text-center file-type-option" [ngClass]="{ 'selected': selectedUploadMethod === 'xml'}" (click)="selectedUploadMethod = 'xml'">
          <i class="fa fa-file-code-o"></i>
          <p>טעינת XML</p>
        </div>
        <div class="col-10 col-sm-4 col-lg-2 offset-1 offset-sm-0 mb-2 mb-sm-0 ml-sm-3 text-center file-type-option" [ngClass]="{ 'selected': selectedUploadMethod === 'excel'}" (click)="selectedUploadMethod = 'excel'">
          <i class="fa fa-file-excel-o"></i>
          <p>טעינת Excel</p>
        </div>
        <div class="col-10 col-sm-4 col-lg-2 offset-1 offset-sm-0 text-center file-type-option" [ngClass]="{ 'selected': selectedUploadMethod === 'manual'}" (click)="selectedUploadMethod = 'manual'">
          <i class="fa fa-file-text-o"></i>
          <p>טעינה ידנית</p>
        </div>
      </div>
      <ng-container *ngIf="selectedUploadMethod === 'excel'">
        <div class="row" [@fadeIn]="selectedUploadMethod === 'excel' ? 'active' : 'inactive'">
          <mat-form-field class="col-12 col-sm-4 offset-sm-1">
            <mat-select name="codeFile" placeholder="קוד קובץ" [(ngModel)]="process.codeFile" #codeSelect="ngModel" required>
              <mat-option [value]="'positive'">חיובי</mat-option>
              <mat-option [value]="'negative'">שלילי</mat-option>
            </mat-select>
            <mat-error *ngIf="codeSelect.errors && f.submitted">יש לבחור קוד קובץ.</mat-error>
          </mat-form-field>
          <mat-form-field class="col-12 col-sm-4 offset-sm-1">
            <input matInput type="number" name="sum" placeholder="סכום" [(ngModel)]="process.totalPaymentFile" #sumInput="ngModel" required>
            <mat-error *ngIf="sumInput.errors && f.submitted">יש לבחור סכום.</mat-error>
          </mat-form-field>
        </div>
      </ng-container>
      <div *ngIf="selectedUploadMethod !== 'manual'" class="mb-5" [@fadeIn]="selectedUploadMethod ? 'active' : 'inactive'">
        <label class="w-100 file-label">
          <div class="file-label-text pr-3">
            <i class="fa fa-upload ml-2"></i>
            <span>{{ file.name ? file.name : 'בחר קובץ להעלאה'}}</span>
          </div>
          <span class="btn btn-primary file-label-button">בחר קובץ</span>
          <input type="file" (change)="file = $event.target.files['0']">
        </label>
        <div class="alert alert-danger" *ngIf="checkFileType() === false">סוג קובץ שגוי, אנא העלה מחדש.</div>
      </div>
      <div *ngIf="selectedUploadMethod !== 'manual'" class="text-center text-md-left mb-3" [hidden]="uploadProgressPercent">
        <button type="submit" class="btn btn-primary">התחל תהליך</button>
      </div>
      <app-employee-payments-table *ngIf="selectedUploadMethod === 'manual'" [process]="this.process"></app-employee-payments-table>
    </form>
    <div class="text-center text-md-left mb-3" [hidden]="!uploadProgressPercent || isFileUploaded">
      <button type="submit" class="btn btn-danger">ביטול</button>
    </div>
    <div class="progress text-center" *ngIf="!isFileUploaded && uploadProgressPercent">
      <div class="progress-bar progress-bar-striped" role="progressbar" [ngStyle]="{ width: uploadProgressPercent + '%' }" aria-valuemin="0" aria-valuemax="100">{{ uploadProgressPercent }}%</div>
    </div>
    <div id="successMessageContainer" class="mt-3 text-center" *ngIf="isFileUploaded">
      <p class="h1">הקובץ נטען בהצלחה!</p>
      <i class="fa fa-check"></i>
      <p class="h6">במידה והתשלום בוצע ניתן להמשיך לשידור הנתונים אחרת יש להמשיך למסך התשלום</p>
      <p class="h6">נא לבחור באפשרות המתאימה:</p>
      <div class="text-center mt-3">
        <button class="btn btn-primary ml-3" (click)="setStepChange(1)">לא שולם, המשך למסך התשלום</button>
        <button class="btn btn-primary" (click)="setStepChange(2)">שולם, המשך לשידור נתונים</button>
      </div>
    </div>
  </div>
</div>
